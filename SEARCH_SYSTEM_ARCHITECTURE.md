# Hybrid Search System - Complete Architecture Diagram

## System Overview
A professional hybrid search system combining TF-IDF keyword search, semantic search, and AI reranking powered by Cerebras LLM.

---

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         HYBRID SEARCH SYSTEM FLOW                             â•‘
â•‘                              Version 2.9.0                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STEP 1: USER INTERACTION                             â”‚
â”‚                         (WordPress Frontend)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ‘¤ User enters query: "environmental compliance services"
                â”‚
                â”‚ (Browser)
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   WordPress Plugin Frontend                         â”‚
    â”‚   ğŸ“ wordpress-plugin/assets/js/hybrid-search.js    â”‚
    â”‚                                                      â”‚
    â”‚   â€¢ User types in search box                        â”‚
    â”‚   â€¢ Debounced autocomplete suggestions (optional)   â”‚
    â”‚   â€¢ Submit search query                             â”‚
    â”‚   â€¢ Display loading state                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ AJAX POST Request
                â”‚ {
                â”‚   query: "environmental compliance services",
                â”‚   limit: 10,
                â”‚   offset: 0,
                â”‚   enable_ai_reranking: true,
                â”‚   ai_weight: 0.7,
                â”‚   include_answer: false
                â”‚ }
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   WordPress Plugin AJAX Handler                     â”‚
    â”‚   ğŸ“ wordpress-plugin/includes/AJAX/AJAXManager.php â”‚
    â”‚                                                      â”‚
    â”‚   â€¢ Validate request                                â”‚
    â”‚   â€¢ Track analytics (query logged)                  â”‚
    â”‚   â€¢ Forward to backend API                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTP POST (Railway/Cloud)
                â”‚ https://your-api.railway.app/search
                â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STEP 2: BACKEND API PROCESSING                          â”‚
â”‚                         (FastAPI Service)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   FastAPI Endpoint: POST /search                    â”‚
    â”‚   ğŸ“ main.py                                        â”‚
    â”‚                                                      â”‚
    â”‚   â€¢ Receive search request                          â”‚
    â”‚   â€¢ Validate parameters                             â”‚
    â”‚   â€¢ Initialize timer for metrics                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Optional: Query Analysis (LLM)                    â”‚
    â”‚   ğŸ“ cerebras_llm.py                                â”‚
    â”‚                                                      â”‚
    â”‚   â€¢ Analyze user intent (optional)                  â”‚
    â”‚   â€¢ Rewrite query if needed                         â”‚
    â”‚   â€¢ Extract key terms                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Search System Orchestrator                        â”‚
    â”‚   ğŸ“ simple_hybrid_search.py                        â”‚
    â”‚                                                      â”‚
    â”‚   â¡ï¸  Forward to hybrid search engine               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 3: QUERY EXPANSION (Optional)                         â”‚
â”‚                       (Synonym & LLM-based)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Query Expander                                    â”‚
    â”‚   ğŸ“ query_expander.py                              â”‚
    â”‚                                                      â”‚
    â”‚   Input: "environmental compliance services"        â”‚
    â”‚                                                      â”‚
    â”‚   Process:                                          â”‚
    â”‚   1. Dictionary-based synonym expansion             â”‚
    â”‚      â€¢ environmental â†’ ecological, sustainability   â”‚
    â”‚      â€¢ compliance â†’ regulatory, conformance         â”‚
    â”‚      â€¢ services â†’ solutions, consulting             â”‚
    â”‚                                                      â”‚
    â”‚   2. Generate query variations:                     â”‚
    â”‚      âœ“ "environmental compliance services"          â”‚
    â”‚      âœ“ "ecological compliance services"             â”‚
    â”‚      âœ“ "environmental regulatory services"          â”‚
    â”‚      âœ“ "sustainability conformance solutions"       â”‚
    â”‚                                                      â”‚
    â”‚   Output: 3-5 query variations                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  STEP 4: TF-IDF KEYWORD SEARCH                                â”‚
â”‚                    (Initial Candidate Retrieval)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   TF-IDF Vectorizer                                 â”‚
    â”‚   ğŸ“ simple_hybrid_search.py                        â”‚
    â”‚                                                      â”‚
    â”‚   Database: 2,892+ indexed documents                â”‚
    â”‚   Features: 10,000 TF-IDF features                  â”‚
    â”‚   N-grams: (1, 2) - unigrams & bigrams              â”‚
    â”‚                                                      â”‚
    â”‚   For EACH expanded query:                          â”‚
    â”‚   1. Transform query â†’ TF-IDF vector                â”‚
    â”‚   2. Calculate cosine similarity vs all docs        â”‚
    â”‚   3. Get top N candidates                           â”‚
    â”‚   4. Combine & deduplicate results                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Cosine Similarity Calculation
                â”‚ similarity = query_vector Â· doc_vector
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Top 30 Candidates Retrieved                       â”‚
    â”‚   (3Ã— limit if AI reranking enabled)                â”‚
    â”‚                                                      â”‚
    â”‚   1. "Compliance Services" ........ Score: 0.92     â”‚
    â”‚   2. "Environmental Regs Guide" .... Score: 0.88    â”‚
    â”‚   3. "Regulatory Consulting" ....... Score: 0.85    â”‚
    â”‚   4. "Impact Assessment" ........... Score: 0.82    â”‚
    â”‚   5. "Training Programs" ........... Score: 0.78    â”‚
    â”‚   ...                                                â”‚
    â”‚   30. "General Engineering" ........ Score: 0.12    â”‚
    â”‚                                                      â”‚
    â”‚   Results sorted by TF-IDF score (descending)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 5: AI RERANKING (Optional)                            â”‚
â”‚                      (Cerebras LLM - llama-3.3-70b)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   AI Reranking Decision                             â”‚
    â”‚                                                      â”‚
    â”‚   IF enable_ai_reranking == true:                   â”‚
    â”‚      âœ… Proceed with AI reranking                   â”‚
    â”‚   ELSE:                                             â”‚
    â”‚      â­ï¸  Skip to STEP 7 (return TF-IDF results)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Prepare LLM Prompt                                â”‚
    â”‚   ğŸ“ cerebras_llm.py â†’ rerank_results()             â”‚
    â”‚                                                      â”‚
    â”‚   â€¢ Take top 20 candidates                          â”‚
    â”‚   â€¢ Format results with ID, title, excerpt          â”‚
    â”‚   â€¢ Include TF-IDF scores                           â”‚
    â”‚   â€¢ Add custom reranking instructions (if any)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Cerebras API Call                                 â”‚
    â”‚   ğŸŒ https://api.cerebras.ai/v1/chat/completions    â”‚
    â”‚                                                      â”‚
    â”‚   Model: llama-3.3-70b                              â”‚
    â”‚   Temperature: 0.1 (deterministic)                  â”‚
    â”‚   Max Tokens: 2000                                  â”‚
    â”‚                                                      â”‚
    â”‚   System Prompt:                                    â”‚
    â”‚   "You are an expert search relevance analyzer.     â”‚
    â”‚    Score each result 0-100 based on:               â”‚
    â”‚    â€¢ Semantic Relevance (40%)                       â”‚
    â”‚    â€¢ User Intent Match (30%)                        â”‚
    â”‚    â€¢ Content Quality (20%)                          â”‚
    â”‚    â€¢ Specificity (10%)"                             â”‚
    â”‚                                                      â”‚
    â”‚   User Prompt:                                      â”‚
    â”‚   "Analyze these results for:                       â”‚
    â”‚    'environmental compliance services'              â”‚
    â”‚                                                      â”‚
    â”‚    Result 1 (ID: 123):                              â”‚
    â”‚    Title: Compliance Services Overview              â”‚
    â”‚    Excerpt: Comprehensive environmental...          â”‚
    â”‚    TF-IDF: 0.92                                     â”‚
    â”‚                                                      â”‚
    â”‚    Result 2 (ID: 456):                              â”‚
    â”‚    Title: Environmental Regulations Guide           â”‚
    â”‚    Excerpt: Detailed guide to...                    â”‚
    â”‚    TF-IDF: 0.88                                     â”‚
    â”‚    ...                                              â”‚
    â”‚                                                      â”‚
    â”‚    Return JSON: [                                   â”‚
    â”‚      {id: '123', ai_score: 88, reason: '...'},     â”‚
    â”‚      {id: '456', ai_score: 96, reason: '...'}      â”‚
    â”‚    ]"                                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ LLM Processing (~1-2 seconds)
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   AI Scores Received                                â”‚
    â”‚                                                      â”‚
    â”‚   [                                                  â”‚
    â”‚     {                                                â”‚
    â”‚       id: "456",                                     â”‚
    â”‚       ai_score: 96,                                  â”‚
    â”‚       reason: "Comprehensive regulatory guide..."   â”‚
    â”‚     },                                               â”‚
    â”‚     {                                                â”‚
    â”‚       id: "123",                                     â”‚
    â”‚       ai_score: 88,                                  â”‚
    â”‚       reason: "Service-focused, highly relevant..." â”‚
    â”‚     },                                               â”‚
    â”‚     ...                                              â”‚
    â”‚   ]                                                  â”‚
    â”‚                                                      â”‚
    â”‚   Tokens Used: ~1,500-2,000                         â”‚
    â”‚   Cost: ~$0.00015-$0.0002 per search                â”‚
    â”‚   Response Time: 1-2 seconds                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STEP 6: HYBRID SCORE CALCULATION                          â”‚
â”‚                        (Weighted Combination)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Hybrid Scoring Formula                            â”‚
    â”‚                                                      â”‚
    â”‚   For each result:                                  â”‚
    â”‚                                                      â”‚
    â”‚   hybrid_score = (tfidf_score Ã— tfidf_weight)       â”‚
    â”‚                + (ai_score Ã— ai_weight)             â”‚
    â”‚                                                      â”‚
    â”‚   Where:                                            â”‚
    â”‚   â€¢ tfidf_weight = 1 - ai_weight                    â”‚
    â”‚   â€¢ ai_weight = 0.7 (default, configurable)         â”‚
    â”‚   â€¢ ai_score normalized to 0-1 (Ã· 100)              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Example Calculations:                             â”‚
    â”‚                                                      â”‚
    â”‚   Result ID: 456                                    â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚   â”‚ TF-IDF Score:  0.88                        â”‚    â”‚
    â”‚   â”‚ AI Score:      0.96 (96 Ã· 100)            â”‚    â”‚
    â”‚   â”‚ AI Weight:     0.7                         â”‚    â”‚
    â”‚   â”‚                                            â”‚    â”‚
    â”‚   â”‚ Hybrid = (0.88 Ã— 0.3) + (0.96 Ã— 0.7)      â”‚    â”‚
    â”‚   â”‚        = 0.264 + 0.672                     â”‚    â”‚
    â”‚   â”‚        = 0.936 â­ (RANK #1)               â”‚    â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚                                                      â”‚
    â”‚   Result ID: 123                                    â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚   â”‚ TF-IDF Score:  0.92                        â”‚    â”‚
    â”‚   â”‚ AI Score:      0.88                        â”‚    â”‚
    â”‚   â”‚                                            â”‚    â”‚
    â”‚   â”‚ Hybrid = (0.92 Ã— 0.3) + (0.88 Ã— 0.7)      â”‚    â”‚
    â”‚   â”‚        = 0.276 + 0.616                     â”‚    â”‚
    â”‚   â”‚        = 0.892 (RANK #2)                   â”‚    â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Sort by Hybrid Score (Descending)                 â”‚
    â”‚   Take Top N Results (limit = 10)                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STEP 7: RESPONSE FORMATTING                              â”‚
â”‚                         (API Response)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Build JSON Response                               â”‚
    â”‚   ğŸ“ main.py                                        â”‚
    â”‚                                                      â”‚
    â”‚   {                                                  â”‚
    â”‚     "success": true,                                â”‚
    â”‚     "results": [                                    â”‚
    â”‚       {                                             â”‚
    â”‚         "id": "456",                                â”‚
    â”‚         "title": "Environmental Regulations Guide", â”‚
    â”‚         "url": "https://site.com/env-regs",        â”‚
    â”‚         "excerpt": "Detailed guide...",            â”‚
    â”‚         "type": "post",                            â”‚
    â”‚         "date": "2024-01-15",                      â”‚
    â”‚         "author": "SCS Engineers",                â”‚
    â”‚         "categories": [...],                       â”‚
    â”‚         "tags": [...],                             â”‚
    â”‚         "score": 0.936,                            â”‚
    â”‚         "relevance": "high"                        â”‚
    â”‚       },                                            â”‚
    â”‚       ...9 more results                            â”‚
    â”‚     ],                                              â”‚
    â”‚     "pagination": {                                â”‚
    â”‚       "offset": 0,                                 â”‚
    â”‚       "limit": 10,                                 â”‚
    â”‚       "has_more": true,                            â”‚
    â”‚       "next_offset": 10,                           â”‚
    â”‚       "total_results": 30                          â”‚
    â”‚     },                                              â”‚
    â”‚     "metadata": {                                  â”‚
    â”‚       "query": "environmental compliance services",â”‚
    â”‚       "total_results": 30,                         â”‚
    â”‚       "returned_results": 10,                      â”‚
    â”‚       "response_time": 1420,  // milliseconds     â”‚
    â”‚       "ai_reranking_used": true,                  â”‚
    â”‚       "ai_weight": 0.7,                            â”‚
    â”‚       "tfidf_weight": 0.3                          â”‚
    â”‚     }                                               â”‚
    â”‚   }                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTP Response (200 OK)
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   WordPress Plugin Receives Response                â”‚
    â”‚   ğŸ“ includes/AJAX/AJAXManager.php                  â”‚
    â”‚                                                      â”‚
    â”‚   â€¢ Parse JSON response                             â”‚
    â”‚   â€¢ Track analytics (CTR, result clicks)            â”‚
    â”‚   â€¢ Cache results (optional)                        â”‚
    â”‚   â€¢ Forward to frontend                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STEP 8: FRONTEND DISPLAY                                â”‚
â”‚                         (WordPress UI)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   JavaScript Rendering                              â”‚
    â”‚   ğŸ“ assets/js/hybrid-search.js                     â”‚
    â”‚                                                      â”‚
    â”‚   â€¢ Hide loading state                              â”‚
    â”‚   â€¢ Clear previous results                          â”‚
    â”‚   â€¢ Render search results with:                     â”‚
    â”‚     - Title (linked)                                â”‚
    â”‚     - Excerpt                                       â”‚
    â”‚     - Metadata (date, author, type)                 â”‚
    â”‚     - Relevance indicator                           â”‚
    â”‚   â€¢ Render pagination controls                      â”‚
    â”‚   â€¢ Show metadata (response time, count)            â”‚
    â”‚   â€¢ Highlight query terms (optional)                â”‚
    â”‚   â€¢ Track result clicks for analytics               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   User Sees Results                                 â”‚
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•      â”‚
    â”‚                                                      â”‚
    â”‚   ğŸ” Search Results (10 of 30)                      â”‚
    â”‚   âš¡ Found in 1.42 seconds                          â”‚
    â”‚                                                      â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚ ğŸ“„ Environmental Regulations Guide         â”‚   â”‚
    â”‚   â”‚ ğŸ”— https://site.com/env-regs               â”‚   â”‚
    â”‚   â”‚                                            â”‚   â”‚
    â”‚   â”‚ Detailed guide to environmental            â”‚   â”‚
    â”‚   â”‚ regulations and compliance requirements... â”‚   â”‚
    â”‚   â”‚                                            â”‚   â”‚
    â”‚   â”‚ ğŸ“… Jan 15, 2024 | âœï¸ SCS Engineers        â”‚   â”‚
    â”‚   â”‚ ğŸ¯ Relevance: High (93.6%)                â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                      â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚ ğŸ“„ Compliance Services Overview            â”‚   â”‚
    â”‚   â”‚ ...                                        â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                      â”‚
    â”‚   ... (8 more results)                              â”‚
    â”‚                                                      â”‚
    â”‚   â—€ Previous  |  1 [2] 3  |  Next â–¶               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    ğŸ‘¤ User clicks result â†’ Analytics tracked (CTR)
                â”‚
                â–¼
    ğŸ“Š Analytics stored in WordPress database
```

---

## Component Details

### 1. WordPress Plugin Components

```
wordpress-plugin/
â”œâ”€â”€ hybrid-search.php              # Main plugin file
â”œâ”€â”€ includes/
â”‚   â”œâ”€â”€ API/
â”‚   â”‚   â”œâ”€â”€ APIClient.php          # HTTP client for backend API
â”‚   â”‚   â””â”€â”€ SearchAPI.php          # Search API wrapper
â”‚   â”œâ”€â”€ AJAX/
â”‚   â”‚   â””â”€â”€ AJAXManager.php        # Handle AJAX search requests
â”‚   â”œâ”€â”€ Admin/
â”‚   â”‚   â”œâ”€â”€ AdminManager.php       # Admin settings page
â”‚   â”‚   â””â”€â”€ DashboardWidget.php    # Analytics dashboard
â”‚   â”œâ”€â”€ Database/
â”‚   â”‚   â”œâ”€â”€ AnalyticsRepository.php # Search analytics storage
â”‚   â”‚   â””â”€â”€ CTRRepository.php      # Click-through rate tracking
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ CacheService.php       # Result caching
â”‚   â”‚   â”œâ”€â”€ SmartCacheService.php  # Smart cache invalidation
â”‚   â”‚   â””â”€â”€ AutoIndexService.php   # Auto-index on content update
â”‚   â””â”€â”€ Frontend/
â”‚       â”œâ”€â”€ FrontendManager.php    # Frontend integration
â”‚       â””â”€â”€ ShortcodeManager.php   # [hybrid_search] shortcode
â””â”€â”€ assets/
    â”œâ”€â”€ js/
    â”‚   â”œâ”€â”€ hybrid-search.js       # Main search UI logic
    â”‚   â”œâ”€â”€ hybrid-search-ui.js    # UI components
    â”‚   â””â”€â”€ hybrid-search-autocomplete.js # Autocomplete
    â””â”€â”€ css/
        â””â”€â”€ hybrid-search-enhanced.css # Styles
```

### 2. Backend API Components

```
Backend (Python/FastAPI)
â”œâ”€â”€ main.py                        # FastAPI app & endpoints
â”œâ”€â”€ simple_hybrid_search.py        # Main search engine
â”œâ”€â”€ cerebras_llm.py               # AI reranking & answers
â”œâ”€â”€ query_expander.py             # Query expansion
â”œâ”€â”€ qdrant_manager.py             # Vector database client
â”œâ”€â”€ wordpress_client.py           # WordPress content fetcher
â”œâ”€â”€ content_chunker.py            # Document chunking
â”œâ”€â”€ zero_result_handler.py        # Handle zero results
â””â”€â”€ suggestions.py                # Autocomplete suggestions
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ (1) User Query
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WordPress Plugin (Frontend)       â”‚
â”‚   - Search UI                       â”‚
â”‚   - AJAX Handler                    â”‚
â”‚   - Analytics Tracking              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ (2) HTTP POST /search
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI Backend (main.py)         â”‚
â”‚   - Request validation              â”‚
â”‚   - Query processing                â”‚
â”‚   - Response formatting             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ (3) search()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Hybrid Search Engine              â”‚
â”‚   - Query expansion                 â”‚
â”‚   - TF-IDF search                   â”‚
â”‚   - AI reranking                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚              â”‚             â”‚
       â–¼                 â–¼              â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Qdrant    â”‚  â”‚  Cerebras    â”‚  â”‚  Query   â”‚  â”‚  TF-IDF  â”‚
â”‚   Vector    â”‚  â”‚    LLM       â”‚  â”‚ Expander â”‚  â”‚ Vectors  â”‚
â”‚   Database  â”‚  â”‚   (AI API)   â”‚  â”‚          â”‚  â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    (Optional)      (Reranking)      (Synonyms)   (Keywords)
```

---

## Indexing Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CONTENT INDEXING FLOW                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TRIGGER: Manual Reindex OR Auto-Index (on post save)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WordPress Content Fetcher (wordpress_client.py)            â”‚
â”‚                                                              â”‚
â”‚  â€¢ Fetch all posts, pages, custom post types               â”‚
â”‚  â€¢ Extract: title, content, excerpt, metadata              â”‚
â”‚  â€¢ Filter by post status (published only)                  â”‚
â”‚                                                              â”‚
â”‚  Output: List of documents                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Content Chunker (content_chunker.py)                       â”‚
â”‚                                                              â”‚
â”‚  â€¢ Split long documents into chunks                         â”‚
â”‚  â€¢ Chunk size: 1000 chars                                   â”‚
â”‚  â€¢ Overlap: 200 chars (preserve context)                    â”‚
â”‚  â€¢ Maintain metadata for each chunk                         â”‚
â”‚                                                              â”‚
â”‚  Example:                                                    â”‚
â”‚  Long article (5000 chars) â†’ 5-6 chunks                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TF-IDF Vectorization                                        â”‚
â”‚                                                              â”‚
â”‚  â€¢ Fit TF-IDF vectorizer on all chunks                      â”‚
â”‚  â€¢ Generate sparse vectors (10,000 features)                â”‚
â”‚  â€¢ Store for keyword search                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Optional: Semantic Embeddings                               â”‚
â”‚                                                              â”‚
â”‚  â€¢ Generate 384-dim embeddings (Sentence Transformers)      â”‚
â”‚  â€¢ Store in Qdrant vector database                          â”‚
â”‚  â€¢ Enable semantic search (future feature)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Index Status: âœ… Ready for Search                          â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š Statistics:                                              â”‚
â”‚  â€¢ Total documents indexed: 2,892                           â”‚
â”‚  â€¢ Total chunks: 3,450+                                     â”‚
â”‚  â€¢ Index size: ~50 MB                                       â”‚
â”‚  â€¢ Time to index: ~2-3 minutes                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## AI Reranking Details

### Why AI Reranking?

**Problem with TF-IDF alone:**
- Only matches keywords, not meaning
- "environmental compliance" vs "regulatory requirements" â†’ missed semantic similarity
- Can't understand user intent or context

**Solution: Hybrid TF-IDF + AI**
- TF-IDF gets high-recall candidates (fast, broad)
- AI reranks for precision (slower, but only top N)
- Best of both worlds: speed + intelligence

### Reranking Algorithm

```python
# 1. Get initial candidates (fast)
candidates = tfidf_search(query, limit=30)  # 3Ã— requested limit

# 2. Take top 20 for AI reranking
top_candidates = candidates[:20]

# 3. Get AI scores
ai_scores = llm.rerank(query, top_candidates)
# Returns: [{"id": "123", "ai_score": 88, "reason": "..."}, ...]

# 4. Calculate hybrid scores
for result in top_candidates:
    tfidf_score = result['score']
    ai_score = ai_scores[result['id']] / 100  # normalize
    
    hybrid_score = (tfidf_score Ã— 0.3) + (ai_score Ã— 0.7)
    result['hybrid_score'] = hybrid_score

# 5. Sort by hybrid score
results = sorted(top_candidates, key=lambda x: x['hybrid_score'], reverse=True)

# 6. Return top N
return results[:10]
```

### Cost & Performance

| Metric | Value |
|--------|-------|
| **Model** | Cerebras llama-3.3-70b |
| **Tokens per search** | 1,500-2,000 |
| **Cost per search** | $0.00015-$0.0002 |
| **Response time** | 1-2 seconds |
| **Monthly cost (10K searches)** | ~$1.50-$2.00 |

---

## Configuration Options

### WordPress Admin Settings

```
Settings â†’ Hybrid Search

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend API Configuration                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  API URL: https://your-api.railway.app               â”‚
â”‚  API Timeout: 30 seconds                              â”‚
â”‚  [Test Connection]                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Search Settings                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  â˜‘ Enable AI Reranking                               â”‚
â”‚  AI Weight: 70% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 100%        â”‚
â”‚  Results per page: 10                                 â”‚
â”‚  Enable query expansion: â˜‘                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Custom AI Instructions (Optional)                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Prioritize recent content and case studies      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Analytics                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  â˜‘ Track search analytics                            â”‚
â”‚  â˜‘ Track click-through rates (CTR)                   â”‚
â”‚  Analytics retention: 90 days                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Features

### âœ… Implemented Features

1. **Hybrid Search**
   - TF-IDF keyword search
   - AI reranking with Cerebras LLM
   - Configurable weights

2. **Query Enhancement**
   - Synonym-based expansion
   - LLM-based query rewriting
   - Multi-query search

3. **Content Management**
   - Auto-indexing on content updates
   - Manual reindex via admin
   - Chunking for long documents

4. **Analytics**
   - Search query tracking
   - Click-through rate (CTR)
   - Zero-result tracking
   - Admin dashboard with stats

5. **Performance**
   - Smart caching
   - Pagination support
   - Response time tracking

6. **User Experience**
   - Autocomplete suggestions
   - Real-time search
   - Professional UI
   - Relevance indicators

### ğŸ”œ Future Enhancements

- Semantic search with embeddings (Qdrant)
- Faceted search (filter by type, date, author)
- Natural language answers (LLM-generated)
- A/B testing for reranking weights
- MCP (Model Context Protocol) integration

---

## API Endpoints

### Search Endpoint

```
POST /search
Content-Type: application/json

Request:
{
  "query": "environmental compliance services",
  "limit": 10,
  "offset": 0,
  "enable_ai_reranking": true,
  "ai_weight": 0.7,
  "ai_reranking_instructions": "",
  "include_answer": false
}

Response:
{
  "success": true,
  "results": [...],
  "pagination": {...},
  "metadata": {
    "query": "environmental compliance services",
    "total_results": 30,
    "returned_results": 10,
    "response_time": 1420,
    "ai_reranking_used": true,
    "ai_weight": 0.7
  }
}
```

### Index Endpoint

```
POST /index
Content-Type: application/json

Request:
{
  "force_reindex": false,
  "post_types": ["post", "page"]
}

Response:
{
  "success": true,
  "message": "Successfully indexed 2,892 documents",
  "indexed_count": 2892,
  "total_count": 2892,
  "processing_time": 145.23
}
```

### Other Endpoints

- `GET /health` - Health check
- `GET /stats` - Index statistics
- `GET /suggest?query=env` - Autocomplete suggestions
- `POST /index-single` - Index single document
- `DELETE /delete-document/{id}` - Delete document

---

## Technology Stack

### Frontend (WordPress)
- **Language**: PHP 7.4+
- **Framework**: WordPress 5.0+
- **JavaScript**: Vanilla JS (ES6+)
- **CSS**: Custom CSS with modern features
- **AJAX**: WordPress REST API compatible

### Backend (API)
- **Language**: Python 3.9+
- **Framework**: FastAPI
- **Search**: scikit-learn (TF-IDF)
- **Vector DB**: Qdrant (optional)
- **LLM**: Cerebras AI (llama-3.3-70b)
- **Async**: asyncio, httpx

### Infrastructure
- **Hosting**: Railway (or any cloud)
- **Database**: Qdrant Cloud (vector storage)
- **Cache**: Redis (optional, future)
- **CDN**: Cloudflare (optional)

---

## Performance Metrics

### Search Performance

| Metric | Target | Actual |
|--------|--------|--------|
| **Search latency (no AI)** | < 200ms | 150-200ms |
| **Search latency (with AI)** | < 2s | 1.4-2s |
| **Index size** | N/A | ~50 MB |
| **Documents indexed** | N/A | 2,892+ |
| **Throughput** | 100 req/s | 50-100 req/s |

### Cost Metrics

| Item | Monthly Cost |
|------|-------------|
| **Cerebras API** (10K searches) | $1.50-$2.00 |
| **Railway hosting** | $5-$20 |
| **Qdrant Cloud** (optional) | $0-$25 |
| **Total** | ~$6.50-$47/month |

---

## Monitoring & Debugging

### Health Checks

```bash
# Check API health
curl https://your-api.railway.app/health

# Check index stats
curl https://your-api.railway.app/stats
```

### Logs

```bash
# Backend logs (Railway)
railway logs

# WordPress logs
tail -f wp-content/debug.log
```

### Admin Dashboard

WordPress Admin â†’ Dashboard â†’ Hybrid Search Widget

Shows:
- Total searches (last 30 days)
- Top queries
- Zero-result queries
- Average response time
- AI reranking usage %

---

**End of Architecture Document**

