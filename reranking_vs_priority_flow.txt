
╔═══════════════════════════════════════════════════════════════════════════════╗
║          AI RERANKING vs POST TYPE PRIORITY - INTERACTION FLOW               ║
╚═══════════════════════════════════════════════════════════════════════════════╝

USER QUERY: "environmental compliance services"
                                │
                                ▼
╔═══════════════════════════════════════════════════════════════════════════════╗
║                    STAGE 1: AI RERANKING (Railway API)                       ║
║                           ⚡ SEMANTIC RELEVANCE                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
                                │
                    ┌───────────┴───────────┐
                    │   TF-IDF Retrieval    │
                    │   (30 candidates)     │
                    └───────────┬───────────┘
                                │
                    ┌───────────┴───────────┐
                    │  Cerebras LLM Scoring │
                    │   (top 20 results)    │
                    └───────────┬───────────┘
                                │
                    ┌───────────┴───────────┐
                    │  Hybrid Score Calc    │
                    │  70% AI + 30% TF-IDF  │
                    └───────────┬───────────┘
                                │
                                ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│  RESULTS FROM AI (sorted by semantic relevance, type-agnostic):              │
│                                                                                │
│  Rank  Title                           Type       AI Score  Hybrid Score      │
│  ────  ──────────────────────────────  ─────────  ────────  ────────────      │
│  #1    "Compliance Guide"               page       0.98      0.936 🏆         │
│  #2    "Environmental Services"         post       0.92      0.892            │
│  #3    "Audit Checklist Download"       download   0.95      0.850            │
│  #4    "Regulatory Overview"            post       0.82      0.820            │
│  #5    "Training Course Materials"      course     0.88      0.798            │
│  #6    "Case Study: ABC Corp"           post       0.77      0.771            │
│  #7    "Compliance FAQ"                 page       0.75      0.745            │
│  #8    "Assessment Tools"               download   0.72      0.720            │
│  #9    "Industry Standards Article"     post       0.70      0.698            │
│  #10   "Contact Compliance Team"        page       0.65      0.650            │
│                                                                                │
│  💡 AI's Decision: "Compliance Guide" is most relevant (0.936)               │
└───────────────────────────────────────────────────────────────────────────────┘
                                │
                                │ Send to WordPress
                                ▼
╔═══════════════════════════════════════════════════════════════════════════════╗
║              STAGE 2: POST TYPE PRIORITY (WordPress Plugin)                  ║
║                         📑 CONTENT TYPE GROUPING                              ║
╚═══════════════════════════════════════════════════════════════════════════════╝
                                │
                    ┌───────────┴───────────┐
                    │  Get Priority Order   │
                    │  ['post', 'page',     │
                    │   'download', 'course']│
                    └───────────┬───────────┘
                                │
                    ┌───────────┴───────────┐
                    │  Group by Post Type   │
                    └───────────┬───────────┘
                                │
                                ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│  GROUPED BY TYPE (AI scores preserved within groups):                        │
│                                                                                │
│  ╔═══════════════════════════════════════════════════════════════════╗       │
│  ║  GROUP 1: POSTS (Priority #1)                                    ║       │
│  ╚═══════════════════════════════════════════════════════════════════╝       │
│    • "Environmental Services" ............... 0.892  (was #2)               │
│    • "Regulatory Overview" .................. 0.820  (was #4)               │
│    • "Case Study: ABC Corp" ................. 0.771  (was #6)               │
│    • "Industry Standards Article" ........... 0.698  (was #9)               │
│                                                                                │
│  ╔═══════════════════════════════════════════════════════════════════╗       │
│  ║  GROUP 2: PAGES (Priority #2)                                    ║       │
│  ╚═══════════════════════════════════════════════════════════════════╝       │
│    • "Compliance Guide" ..................... 0.936  (was #1) ⬇️ DEMOTED!   │
│    • "Compliance FAQ" ....................... 0.745  (was #7)               │
│    • "Contact Compliance Team" .............. 0.650  (was #10)              │
│                                                                                │
│  ╔═══════════════════════════════════════════════════════════════════╗       │
│  ║  GROUP 3: DOWNLOADS (Priority #3)                                ║       │
│  ╚═══════════════════════════════════════════════════════════════════╝       │
│    • "Audit Checklist Download" ............. 0.850  (was #3)               │
│    • "Assessment Tools" ..................... 0.720  (was #8)               │
│                                                                                │
│  ╔═══════════════════════════════════════════════════════════════════╗       │
│  ║  GROUP 4: COURSES (Priority #4)                                  ║       │
│  ╚═══════════════════════════════════════════════════════════════════╝       │
│    • "Training Course Materials" ............ 0.798  (was #5)               │
└───────────────────────────────────────────────────────────────────────────────┘
                                │
                    ┌───────────┴───────────┐
                    │ Reassemble in Priority│
                    │ Order (groups → list) │
                    └───────────┬───────────┘
                                │
                                ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│  FINAL RESULTS TO USER:                                                       │
│  ═════════════════════════════════════════════════════════════════════════    │
│                                                                                │
│  🥇 #1  "Environmental Services" (post) ............... 0.892                │
│         📊 AI decided this was #2, but posts are priority #1                 │
│                                                                                │
│  🥈 #2  "Regulatory Overview" (post) .................. 0.820                │
│         📊 AI decided this was #4                                             │
│                                                                                │
│  🥉 #3  "Case Study: ABC Corp" (post) ................. 0.771                │
│         📊 AI decided this was #6                                             │
│                                                                                │
│  4️⃣  #4  "Industry Standards Article" (post) ......... 0.698                │
│         📊 AI decided this was #9                                             │
│                                                                                │
│  5️⃣  #5  "Compliance Guide" (page) ................... 0.936  ⚠️            │
│         📊 AI's #1 CHOICE but demoted due to type priority!                  │
│         💡 Most relevant result is now 5th!                                   │
│                                                                                │
│  6️⃣  #6  "Compliance FAQ" (page) ..................... 0.745                │
│  7️⃣  #7  "Contact Compliance Team" (page) ............ 0.650                │
│  8️⃣  #8  "Audit Checklist Download" (download) ....... 0.850                │
│  9️⃣  #9  "Assessment Tools" (download) ............... 0.720                │
│  🔟 #10 "Training Course Materials" (course) ......... 0.798                │
└───────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════╗
║                            KEY INSIGHTS                                       ║
╚═══════════════════════════════════════════════════════════════════════════════╝

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  🤖 AI RERANKING (Stage 1):                                             │
  │  ───────────────────────────────────────────────────────────────────    │
  │  • Analyzes SEMANTIC MEANING                                             │
  │  • Scores by relevance, intent, quality                                  │
  │  • IGNORES post type completely                                          │
  │  • Result: "Compliance Guide" is #1 (most relevant)                     │
  └─────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  📑 POST TYPE PRIORITY (Stage 2):                                       │
  │  ───────────────────────────────────────────────────────────────────    │
  │  • Groups results by CONTENT TYPE                                        │
  │  • Reorders groups by priority: posts > pages > downloads > courses     │
  │  • PRESERVES AI ranking within each group                                │
  │  • Result: All posts appear before pages, even if less relevant         │
  └─────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  ⚖️  THE CONFLICT:                                                       │
  │  ───────────────────────────────────────────────────────────────────    │
  │  AI says: "Compliance Guide (page) is most relevant" (0.936)           │
  │  Priority says: "Show all posts first, regardless of relevance"         │
  │  Winner: POST TYPE PRIORITY (it runs second, so it wins)                │
  │  Result: Most relevant result (#1 by AI) demoted to #5!                 │
  └─────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════╗
║                        WHEN DOES THIS MAKE SENSE?                            ║
╚═══════════════════════════════════════════════════════════════════════════════╝

  ✅ GOOD USE CASES FOR POST TYPE PRIORITY:

  1. Blog/News Sites
     • Users expect articles (posts) first
     • Static pages (about, contact) are secondary
     • Example: News query → show articles before about page

  2. Documentation Sites
     • Guides (tutorials) should appear before API reference
     • How-to content prioritized over general info
     • Example: "how to install" → tutorials before FAQs

  3. E-commerce Sites
     • Products before blog posts
     • Category pages before informational content
     • Example: "buy laptop" → products before reviews

  ❌ BAD USE CASES (where priority hurts):

  1. Navigational Queries
     • "contact us" → should show contact page immediately
     • But if posts prioritized, contact page gets buried
     • Solution: Disable priority for navigational queries

  2. Specific Questions
     • "how to conduct audit" → best guide should be #1
     • But if posts prioritized, inferior posts appear first
     • Solution: Trust AI ranking for question-based queries

  3. Equal Content Types
     • All content is similar (all articles, all guides)
     • Type priority adds no value
     • Solution: Disable priority, use AI ranking only

╔═══════════════════════════════════════════════════════════════════════════════╗
║                            CONFIGURATION                                      ║
╚═══════════════════════════════════════════════════════════════════════════════╝

  📍 WordPress Admin → Settings → Hybrid Search

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  AI RERANKING SETTINGS:                                                 │
  │  ───────────────────────────────────────────────────────────────────    │
  │  ☑ Enable AI Reranking                                                  │
  │  AI Weight: [=========>    ] 70%                                        │
  │  (Controls: How much AI influences scores)                              │
  └─────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  POST TYPE PRIORITY SETTINGS:                                           │
  │  ───────────────────────────────────────────────────────────────────    │
  │  Drag to reorder (top = highest priority):                              │
  │  1. ☰ Posts                                                             │
  │  2. ☰ Pages                                                             │
  │  3. ☰ Downloads                                                         │
  │  4. ☰ Courses                                                           │
  │                                                                          │
  │  💡 Tip: Put most important content type at top                         │
  └─────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════╗
║                         SOLUTIONS TO CONFLICTS                                ║
╚═══════════════════════════════════════════════════════════════════════════════╝

  OPTION 1: Adjust Priority Order
  ─────────────────────────────────────────────────────────────────────────────
  If pages (guides) are often most relevant, put them first:
  1. ☰ Pages  ← Move up
  2. ☰ Posts
  3. ☰ Downloads

  OPTION 2: Increase AI Weight
  ─────────────────────────────────────────────────────────────────────────────
  AI Weight: [============>  ] 90%
  Makes relevance gap larger → harder for priority to override

  OPTION 3: Disable Priority for Specific Queries
  ─────────────────────────────────────────────────────────────────────────────
  if (query.contains("how to") || query.contains("what is")) {
      return ai_results;  // Skip type priority
  }

  OPTION 4: Hybrid Approach (Best of Both)
  ─────────────────────────────────────────────────────────────────────────────
  // Top 3 by AI relevance, then type priority for rest
  $top3 = slice($ai_results, 0, 3);
  $rest = applyPriority(slice($ai_results, 3));
  return merge($top3, $rest);

  OPTION 5: Score Boosting Instead of Grouping
  ─────────────────────────────────────────────────────────────────────────────
  // Add boost to preferred types instead of strict grouping
  foreach ($result as $item) {
      if ($item['type'] == 'post') {
          $item['score'] += 0.10;  // +10% boost
      }
  }
  sort_by_score($results);  // Re-sort with boosts

═══════════════════════════════════════════════════════════════════════════════

                           🎯 BOTTOM LINE

  AI Reranking:        Finds the BEST answer (semantic relevance)
  Post Type Priority:  Shows CONTENT TYPE you prefer (structural preference)
  
  They work in SEQUENCE, not in PARALLEL
  
  Stage 1: AI says "this is most relevant" 
  Stage 2: Priority says "but show this type first"
  
  Result: Priority OVERRIDES relevance (it runs last, so it wins)

  🤔 Is this what you want?
     • YES → Keep current setup (type grouping matters)
     • NO → Disable priority or use weighted boosting instead

═══════════════════════════════════════════════════════════════════════════════


